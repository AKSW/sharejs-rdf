(function(){var a,b,c,d,e,f,g,h,i,j,k,l;"object"==typeof window&&window.document&&(d=!0),j=function(a){return c.hash(a)},i=function(a){var b;return(b=function(a,b){var c,d,e,f;for(d="",e=0,f=b.length;f>e;e++)c=b[e],"undefined"!=typeof a[c]&&(d+=""+c+":'"+a[c]+"';");return j(d)})(a,["type","value","lang","datatype"])},f=function(a){var b,c,d,e,f,g,h,i,j,k;k={};for(j in a){i=a[j],k[j]={};for(h in i){g=i[h],k[j][h]={};for(f in g){d=g[f],e={};for(b in d)c=d[b],e[b]=c;k[j][h][f]=e}}}return k},e=function(a){var b,c,d,e,f,g,h,i,j,k,l;j={};for(i in a){h=a[i],j[i]={};for(g in h)for(f=h[g],j[i][g]=[],k=0,l=f.length;l>k;k++){d=f[k],e={};for(b in d)c=d[b],e[b]=c;j[i][g].push(e)}}return j},h=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;c={},l=0;for(k in a)if(j=a[k],b[k])for(i in j)if(f=j[i],b[k][i]){for(g=b[k][i],h=[],m=0,o=f.length;o>m;m++)for(d=f[m],n=0,p=g.length;p>n;n++)e=g[n],d.type===e.type&&d.value===e.value&&d.lang===e.lang&&d.datatype===e.datatype&&(h.push(d),l++);h.length>0&&(c[k]||(c[k]={}),c[k][i]=h)}return[c,l]},g=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;k={};for(j in a){i=a[j];for(h in i){if(e=i[h],g=[],b[j]&&b[j][h])for(f=b[j][h],l=0,n=e.length;n>l;l++)for(c=e[l],m=0,o=f.length;o>m;m++)d=f[m],(c.type!==d.type||c.value!==d.value||c.lang!==d.lang||c.datatype!==d.datatype)&&g.push(c);else g=e;g.length>0&&(k[j]||(k[j]={}),k[j][h]=g)}}return k},a=function(){function a(a){null==a&&(a={}),this._uriRegex=/^\w+:\/\/\w+(\.\w+)+\//,this._triples={},this.insert(a)}return a.prototype.exportTriples=function(){var a,b,c,d,e,f,g,h,i,j,k;h={},k=this._triples;for(g in k){f=k[g],h[g]={};for(e in f){d=f[e],h[g][e]=[],c=[];for(b in d)a=d[b],c.push(b);for(c.sort(),i=0,j=c.length;j>i;i++)b=c[i],a=d[b],h[g][e].push(a)}}return h},a.prototype.clone=function(){var b;return b=new a,b._triples=f(this._triples),b},a.prototype.insert=function(a){var b,c,d,e,f,g,h;h=[];for(g in a)f=a[g],this.assertSubjectIsUri(g),this._triples[g]||(this._triples[g]={}),h.push(function(){var a;a=[];for(e in f)d=f[e],this.assertPredicateIsUri(e,g),this.assertObjectsArray(d,g,e),this._triples[g][e]||(this._triples[g][e]={}),a.push(function(){var a,f,h;for(h=[],a=0,f=d.length;f>a;a++)b=d[a],c=i(b),h.push(this._triples[g][e][c]=b);return h}.call(this));return a}.call(this));return h},a.prototype["delete"]=function(a){var b,c,d,e,f,g,h,j,k,l,m,n,o,p;p=[];for(m in a)if(h=a[m],this.assertSubjectIsUri(m),this._triples[m]){f=0;for(g in h)if(e=h[g],this.assertPredicateIsUri(g,m),this.assertObjectsArray(e,m,g),f++,this._triples[m][g]){for(l=this._triples[m][g],n=0,o=e.length;o>n;n++)c=e[n],d=i(c),l[d]&&delete this._triples[m][g][d];b=0;for(k in l)j=l[k],b++;0===b&&(f--,delete this._triples[m][g])}p.push(0===f?delete this._triples[m]:void 0)}return p},a.prototype.assertSubjectIsUri=function(a){if("string"!=typeof a||!this.isUri(a))throw new Error("Subject must be an URI: "+a)},a.prototype.assertPredicateIsUri=function(a,b){if("string"!=typeof a||!this.isUri(a))throw new Error("Predicate must be an URI: "+a+" (of subject "+b+")")},a.prototype.assertObjectsArray=function(a,b,c){if("object"!=typeof a||!(a instanceof Array))throw new Error("Objects must be an array of objects: "+a+" (of subject "+b+", predicate "+c+")")},a.prototype.isUri=function(a){return a.match(this._uriRegex)},a}(),b=function(){function a(a,b){this.operation=function(){return a},this._triples=b}return a.prototype.OP_INSERT="insert",a.prototype.OP_DELETE="delete",a.insert=function(b){return new a(a.prototype.OP_INSERT,b)},a["delete"]=function(b){return new a(a.prototype.OP_DELETE,b)},a.prototype.clone=function(){return new a(this.operation(),e(this.getTriples()))},a.prototype.getTriples=function(){return this._triples},a.prototype.setTriples=function(a){return this._triples=a},a}(),k={Doc:a,Operation:b,name:"rdf-json",create:function(){return new a},apply:function(c,d){var e;if(!(c instanceof a))throw new Error("Snapshot must be a RdfJsonDoc instance. Given: "+c);if(!(d instanceof b))throw new Error("Operation must be a RdfJsonOperation instance. Given: "+d);switch(e=c.clone(),d.operation()){case b.prototype.OP_INSERT:e.insert(d.getTriples());break;case b.prototype.OP_DELETE:e["delete"](d.getTriples())}return e},transform:function(a,b,c){var d,e,f,i,j,k;if(e=a.clone(),d="right"===c,"left"!==c&&"right"!==c)throw new Error("Bad parameter 'side' given: "+c);return d?e:a.operation()===b.operation()?e:(k=h(a.getTriples(),b.getTriples()),i=k[0],j=k[1],0===j?e:(f=g(a.getTriples(),b.getTriples()),e.setTriples(f),e))}},null!=d?(l=window.sharejs,l.types||(l.types={}),l.types["rdf-json"]=k):(c=require("spark-md5"),module.exports=k)}).call(this);