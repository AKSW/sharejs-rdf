var WEB=!0,RdfJsonDoc,RdfJsonOperation,SparkMD5,WEB,cloneExportTriples,cloneTriples,exportTriples,exportTriplesDifference,exportTriplesIntersect,exportTriplesUnion,hashTripleObject,isTriplesEmpty,md5,rdfJson,sharejs;"object"==typeof window&&window.document&&(WEB=!0),md5=function(a){return SparkMD5.hash(a)},hashTripleObject=function(a){var b;return(b=function(a,b){var c,d,e,f;for(d="",e=0,f=b.length;f>e;e++)c=b[e],"undefined"!=typeof a[c]&&(d+=""+c+":'"+a[c]+"';");return md5(d)})(a,["type","value","lang","datatype"])},isTriplesEmpty=function(a){var b,c;for(b in a)return c=a[b],!1;return!0},cloneTriples=function(a){var b,c,d,e,f,g,h,i,j,k;k={};for(j in a){i=a[j],k[j]={};for(h in i){g=i[h],k[j][h]={};for(f in g){d=g[f],e={};for(b in d)c=d[b],e[b]=c;k[j][h][f]=e}}}return k},cloneExportTriples=function(a){var b,c,d,e,f,g,h,i,j,k,l;j={};for(i in a){h=a[i],j[i]={};for(g in h)for(f=h[g],j[i][g]=[],k=0,l=f.length;l>k;k++){d=f[k],e={};for(b in d)c=d[b],e[b]=c;j[i][g].push(e)}}return j},exportTriples=function(a){var b,c,d,e,f,g,h,i,j,k;i={};for(h in a){g=a[h],i[h]={};for(f in g){e=g[f],i[h][f]=[],d=[];for(c in e)b=e[c],d.push(c);for(d.sort(),j=0,k=d.length;k>j;j++)c=d[j],b=e[c],i[h][f].push(b)}}return i},exportTriplesIntersect=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;c={};for(k in a)if(j=a[k],b[k])for(i in j)if(f=j[i],b[k][i]){for(g=b[k][i],h=[],l=0,n=f.length;n>l;l++)for(d=f[l],m=0,o=g.length;o>m;m++)e=g[m],d.type===e.type&&d.value===e.value&&d.lang===e.lang&&d.datatype===e.datatype&&h.push(d);h.length>0&&(c[k]||(c[k]={}),c[k][i]=h)}return c},exportTriplesUnion=function(a,b){var c,d,e,f;return e={},d=function(a,b){var c,d,e,f,g,h,i;for(d=["type","value","lang","datatype"],f=0,h=a.length;h>f;f++){for(a=a[f],c=!0,g=0,i=d.length;i>g;g++)if(e=d[g],object[e]!==b[e]){c=!1;break}if(c)return!0}return!1},c=function(a,b,c){return e[a]||(e[a]={}),e[a][b]||(e[a][b]=[]),d(e[a][b],c)?void 0:e[a][b].push(c)},f=function(a,b){var c,d,e,f,g,h;h=[];for(g in a)f=a[g],h.push(function(){var a;a=[];for(e in f)d=f[e],a.push(function(){var a,f,h;for(h=[],a=0,f=d.length;f>a;a++)c=d[a],h.push(b(g,e,c));return h}());return a}());return h},f(a,c),f(b,c),e},exportTriplesDifference=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;k={};for(j in a){i=a[j];for(h in i){if(e=i[h],g=[],b[j]&&b[j][h])for(f=b[j][h],l=0,n=e.length;n>l;l++)for(c=e[l],m=0,o=f.length;o>m;m++)d=f[m],(c.type!==d.type||c.value!==d.value||c.lang!==d.lang||c.datatype!==d.datatype)&&g.push(c);else g=e;g.length>0&&(k[j]||(k[j]={}),k[j][h]=g)}}return k},RdfJsonDoc=function(){function a(a){null==a&&(a={}),this._uriRegex=/^\w+:\/\/\w+(\.\w+)+\//,this._triples={},this.insert(a)}return a.byInternalTripleSet=function(b){var c;return c=new a,c._triples=b,c},a.prototype.exportTriples=function(){return exportTriples(this._triples)},a.prototype.clone=function(){var b;return b=new a,b._triples=cloneTriples(this._triples),b},a.prototype.insert=function(a){var b,c,d,e,f,g,h;h=[];for(g in a)f=a[g],this.assertSubjectIsUri(g),this._triples[g]||(this._triples[g]={}),h.push(function(){var a;a=[];for(e in f)d=f[e],this.assertPredicateIsUri(e,g),this.assertObjectsArray(d,g,e),this._triples[g][e]||(this._triples[g][e]={}),a.push(function(){var a,f,h;for(h=[],a=0,f=d.length;f>a;a++)b=d[a],c=hashTripleObject(b),h.push(this._triples[g][e][c]=b);return h}.call(this));return a}.call(this));return h},a.prototype["delete"]=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;o=[];for(l in a)if(h=a[l],this.assertSubjectIsUri(l),this._triples[l]){f=0;for(g in h)if(e=h[g],this.assertPredicateIsUri(g,l),this.assertObjectsArray(e,l,g),f++,this._triples[l][g]){for(k=this._triples[l][g],m=0,n=e.length;n>m;m++)c=e[m],d=hashTripleObject(c),k[d]&&delete this._triples[l][g][d];b=0;for(j in k)i=k[j],b++;0===b&&(f--,delete this._triples[l][g])}o.push(0===f?delete this._triples[l]:void 0)}return o},a.prototype.assertSubjectIsUri=function(a){if("string"!=typeof a||!this.isUri(a))throw new Error("Subject must be an URI: "+a)},a.prototype.assertPredicateIsUri=function(a,b){if("string"!=typeof a||!this.isUri(a))throw new Error("Predicate must be an URI: "+a+" (of subject "+b+")")},a.prototype.assertObjectsArray=function(a,b,c){if("object"!=typeof a||!(a instanceof Array))throw new Error("Objects must be an array of objects: "+a+" (of subject "+b+", predicate "+c+")")},a.prototype.isUri=function(a){return a.match(this._uriRegex)},a}(),RdfJsonOperation=function(){function a(a,b){this._triplesAdd=a,this._triplesDel=b}return a.insert=function(b){return new a(b,{})},a["delete"]=function(b){return new a({},b)},a.prototype.clone=function(){return new a(cloneExportTriples(this.getTriplesToAdd()),cloneExportTriples(this.getTriplesToDel()))},a.prototype.getTriplesToAdd=function(){return this._triplesAdd},a.prototype.setTriplesToAdd=function(a){return this._triplesAdd=a},a.prototype.hasTriplesToAdd=function(){return!this._triplesEmpty(this._triplesAdd)},a.prototype.getTriplesToDel=function(){return this._triplesDel},a.prototype.setTriplesToDel=function(a){return this._triplesDel=a},a.prototype.hasTriplesToDel=function(){return!this._triplesEmpty(this._triplesDel)},a.prototype._triplesEmpty=function(a){var b,c;for(b in a)return c=a[b],!1;return!0},a}(),rdfJson={Doc:RdfJsonDoc,Operation:RdfJsonOperation,exportTriples:exportTriples,name:"rdf-json",create:function(){return new RdfJsonDoc},apply:function(a,b){var c;return a=this._ensureDoc(a),b=this._ensureOp(b),c=a.clone(),b.hasTriplesToAdd()&&c.insert(b.getTriplesToAdd()),b.hasTriplesToDel()&&c["delete"](b.getTriplesToDel()),c},transform:function(a,b,c){var d,e,f;if(f=function(a,b){var c;return c=exportTriplesIntersect(a,b),exportTriplesDifference(a,c)},e=a.clone(),d="right"===c,"left"!==c&&"right"!==c)throw new Error("Bad parameter 'side' given: "+c);return d?e:isTriplesEmpty(a.getTriplesToAdd())&&isTriplesEmpty(b.getTriplesToAdd())?e:isTriplesEmpty(a.getTriplesToDel())&&isTriplesEmpty(b.getTriplesToDel())?e:(e.setTriplesToAdd(exportTriplesDifference(a.getTriplesToAdd(),b.getTriplesToDel())),e.setTriplesToDel(exportTriplesDifference(a.getTriplesToDel(),b.getTriplesToAdd())),e)},compose:function(a,b){var c,d,e,f;return d=exportTriplesUnion(a.getTriplesToAdd(),b.getTriplesToAdd()),f=exportTriplesUnion(a.getTriplesToDel(),b.getTriplesToDel()),c=exportTriplesDifference(d,f),e=exportTriplesDifference(f,d),new RdfJsonOperation(c,e)},_ensureDoc:function(a){if(a instanceof RdfJsonDoc)return a;if("object"==typeof a&&a._triples)return RdfJsonDoc.byInternalTripleSet(a._triples);throw new Error("Snapshot must be a rdf-json document. Given: "+snapshot)},_ensureOp:function(a){if(a instanceof RdfJsonOperation)return a;if("object"==typeof a&&a._triplesAdd&&a._triplesDel)return new RdfJsonOperation(a._triplesAdd,a._triplesDel);throw new Error("Operation must be a rdf-json operation. Given: "+a)}},null!=WEB?(sharejs=window.sharejs,sharejs.types||(sharejs.types={}),sharejs.types["rdf-json"]=rdfJson):(SparkMD5=require("spark-md5"),module.exports=rdfJson);var rdfJson;"undefined"==typeof WEB&&(rdfJson=require("./rdf-json")),rdfJson.api={provides:{rdfJson:!0},getData:function(){return rdfJson.exportTriples(this.snapshot._triples)},insert:function(a,b){var c;return c=rdfJson.Operation.insert(a),this.submitOp(c,b),c},"delete":function(a,b){var c;return c=rdfJson.Operation["delete"](a),this.submitOp(c,b),c},update:function(a,b,c){var d;return d=new rdfJson.Operation(a,b),this.submitOp(d,c),d},_register:function(){return this.on("remoteop",function(a){return this.emit("update",a._triplesAdd,a._triplesDel)})}};var HybridDoc,HybridOp,WEB,hybridOT,rdfJsonOT,sharejs,textOT;"object"==typeof window&&window.document&&(WEB=!0),rdfJsonOT=null,textOT=null,HybridDoc=function(){function a(a,b){this.turtleContent=a,this.rdfJsonContent=b}return a.prototype.clone=function(){return new a(this.turtleContent,this.rdfJsonContent)},a.prototype.getTurtleContent=function(){return this.turtleContent},a.prototype.setTurtleContent=function(a){return this.turtleContent=a},a.prototype.getRdfJsonContent=function(){return this.rdfJsonContent},a.prototype.setRdfJsonContent=function(a){return this.rdfJsonContent=a},a}(),HybridOp=function(){function a(a,b,c){this.textOps=a,this.rdfInsertions=b,this.rdfDeletions=c}return a.fromData=function(b){return new a(b.textOps,b.rdfInsertions,b.rdfDeletions)},a.prototype.clone=function(){return new a(this.textOps.slice(),this.rdfInsertions.slice(),this.rdfDeletions.slice())},a.prototype.getTextOps=function(){return this.textOps},a.prototype.setTextOps=function(a){return this.textOps=a},a.prototype.getRdfInsertions=function(){return this.rdfInsertions},a.prototype.setRdfInsertions=function(a){return this.rdfInsertions=a},a.prototype.getRdfDeletions=function(){return this.rdfDeletions},a.prototype.setRdfDeletions=function(a){return this.rdfDeletions=a},a}(),hybridOT={name:"turtle-rdf-json",doc:HybridDoc,op:HybridOp,create:function(){return new HybridDoc("",{})},apply:function(){},transform:function(){},compose:function(){}},null!=WEB?(sharejs=window.sharejs,rdfJsonOT=sharejs.types["rdf-json"],textOT=sharejs.types.text,sharejs.types||(sharejs.types={}),sharejs.types["turtle-rdf-json"]=hybridOT):(textOT=require("../../node_modules/share/lib/types/text"),rdfJsonOT=require("./rdf-json"),module.exports=hybridOT),function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;try{b=window}catch(c){b=self}b.SparkMD5=a()}}(function(){"use strict";var a=function(a,b){return a+b&4294967295},b=function(b,c,d,e,f,g){return c=a(a(c,b),a(e,g)),a(c<<f|c>>>32-f,d)},c=function(a,c,d,e,f,g,h){return b(c&d|~c&e,a,c,f,g,h)},d=function(a,c,d,e,f,g,h){return b(c&e|d&~e,a,c,f,g,h)},e=function(a,c,d,e,f,g,h){return b(c^d^e,a,c,f,g,h)},f=function(a,c,d,e,f,g,h){return b(d^(c|~e),a,c,f,g,h)},g=function(b,g){var h=b[0],i=b[1],j=b[2],k=b[3];h=c(h,i,j,k,g[0],7,-680876936),k=c(k,h,i,j,g[1],12,-389564586),j=c(j,k,h,i,g[2],17,606105819),i=c(i,j,k,h,g[3],22,-1044525330),h=c(h,i,j,k,g[4],7,-176418897),k=c(k,h,i,j,g[5],12,1200080426),j=c(j,k,h,i,g[6],17,-1473231341),i=c(i,j,k,h,g[7],22,-45705983),h=c(h,i,j,k,g[8],7,1770035416),k=c(k,h,i,j,g[9],12,-1958414417),j=c(j,k,h,i,g[10],17,-42063),i=c(i,j,k,h,g[11],22,-1990404162),h=c(h,i,j,k,g[12],7,1804603682),k=c(k,h,i,j,g[13],12,-40341101),j=c(j,k,h,i,g[14],17,-1502002290),i=c(i,j,k,h,g[15],22,1236535329),h=d(h,i,j,k,g[1],5,-165796510),k=d(k,h,i,j,g[6],9,-1069501632),j=d(j,k,h,i,g[11],14,643717713),i=d(i,j,k,h,g[0],20,-373897302),h=d(h,i,j,k,g[5],5,-701558691),k=d(k,h,i,j,g[10],9,38016083),j=d(j,k,h,i,g[15],14,-660478335),i=d(i,j,k,h,g[4],20,-405537848),h=d(h,i,j,k,g[9],5,568446438),k=d(k,h,i,j,g[14],9,-1019803690),j=d(j,k,h,i,g[3],14,-187363961),i=d(i,j,k,h,g[8],20,1163531501),h=d(h,i,j,k,g[13],5,-1444681467),k=d(k,h,i,j,g[2],9,-51403784),j=d(j,k,h,i,g[7],14,1735328473),i=d(i,j,k,h,g[12],20,-1926607734),h=e(h,i,j,k,g[5],4,-378558),k=e(k,h,i,j,g[8],11,-2022574463),j=e(j,k,h,i,g[11],16,1839030562),i=e(i,j,k,h,g[14],23,-35309556),h=e(h,i,j,k,g[1],4,-1530992060),k=e(k,h,i,j,g[4],11,1272893353),j=e(j,k,h,i,g[7],16,-155497632),i=e(i,j,k,h,g[10],23,-1094730640),h=e(h,i,j,k,g[13],4,681279174),k=e(k,h,i,j,g[0],11,-358537222),j=e(j,k,h,i,g[3],16,-722521979),i=e(i,j,k,h,g[6],23,76029189),h=e(h,i,j,k,g[9],4,-640364487),k=e(k,h,i,j,g[12],11,-421815835),j=e(j,k,h,i,g[15],16,530742520),i=e(i,j,k,h,g[2],23,-995338651),h=f(h,i,j,k,g[0],6,-198630844),k=f(k,h,i,j,g[7],10,1126891415),j=f(j,k,h,i,g[14],15,-1416354905),i=f(i,j,k,h,g[5],21,-57434055),h=f(h,i,j,k,g[12],6,1700485571),k=f(k,h,i,j,g[3],10,-1894986606),j=f(j,k,h,i,g[10],15,-1051523),i=f(i,j,k,h,g[1],21,-2054922799),h=f(h,i,j,k,g[8],6,1873313359),k=f(k,h,i,j,g[15],10,-30611744),j=f(j,k,h,i,g[6],15,-1560198380),i=f(i,j,k,h,g[13],21,1309151649),h=f(h,i,j,k,g[4],6,-145523070),k=f(k,h,i,j,g[11],10,-1120210379),j=f(j,k,h,i,g[2],15,718787259),i=f(i,j,k,h,g[9],21,-343485551),b[0]=a(h,b[0]),b[1]=a(i,b[1]),b[2]=a(j,b[2]),b[3]=a(k,b[3])},h=function(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c},i=function(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24);return c},j=function(a){var b,c,d,e,f,i,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;j>=b;b+=64)g(k,h(a.substring(b-64,b)));for(a=a.substring(b-64),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a.charCodeAt(b)<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(g(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*j,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),i=parseInt(e[1],16)||0,d[14]=f,d[15]=i,g(k,d),k},k=function(a){var b,c,d,e,f,h,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;j>=b;b+=64)g(k,i(a.subarray(b-64,b)));for(a=j>b-64?a.subarray(b-64):new Uint8Array(0),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a[b]<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(g(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*j,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),h=parseInt(e[1],16)||0,d[14]=f,d[15]=h,g(k,d),k},l=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],m=function(a){var b,c="";for(b=0;4>b;b+=1)c+=l[a>>8*b+4&15]+l[a>>8*b&15];return c},n=function(a){var b;for(b=0;b<a.length;b+=1)a[b]=m(a[b]);return a.join("")},o=function(a){return n(j(a))},p=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==o("hello")&&(a=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}),p.prototype.append=function(a){return/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a))),this.appendBinary(a),this},p.prototype.appendBinary=function(a){this._buff+=a,this._length+=a.length;var b,c=this._buff.length;for(b=64;c>=b;b+=64)g(this._state,h(this._buff.substring(b-64,b)));return this._buff=this._buff.substr(b-64),this},p.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;e>b;b+=1)f[b>>2]|=d.charCodeAt(b)<<(b%4<<3);return this._finish(f,e),c=a?this._state:n(this._state),this.reset(),c},p.prototype._finish=function(a,b){var c,d,e,f=b;if(a[f>>2]|=128<<(f%4<<3),f>55)for(g(this._state,a),f=0;16>f;f+=1)a[f]=0;c=8*this._length,c=c.toString(16).match(/(.*?)(.{0,8})$/),d=parseInt(c[2],16),e=parseInt(c[1],16)||0,a[14]=d,a[15]=e,g(this._state,a)},p.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},p.prototype.destroy=function(){delete this._state,delete this._buff,delete this._length},p.hash=function(a,b){/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a)));var c=j(a);return b?c:n(c)},p.hashBinary=function(a,b){var c=j(a);return b?c:n(c)},p.ArrayBuffer=function(){this.reset()},p.ArrayBuffer.prototype.append=function(a){var b,c=this._concatArrayBuffer(this._buff,a),d=c.length;for(this._length+=a.byteLength,b=64;d>=b;b+=64)g(this._state,i(c.subarray(b-64,b)));return this._buff=d>b-64?c.subarray(b-64):new Uint8Array(0),this},p.ArrayBuffer.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;e>b;b+=1)f[b>>2]|=d[b]<<(b%4<<3);return this._finish(f,e),c=a?this._state:n(this._state),this.reset(),c},p.ArrayBuffer.prototype._finish=p.prototype._finish,p.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},p.ArrayBuffer.prototype.destroy=p.prototype.destroy,p.ArrayBuffer.prototype._concatArrayBuffer=function(a,b){var c=a.length,d=new Uint8Array(c+b.byteLength);return d.set(a),d.set(new Uint8Array(b),c),d},p.ArrayBuffer.hash=function(a,b){var c=k(new Uint8Array(a));return b?c:n(c)},p});